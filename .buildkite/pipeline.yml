env:
  CHARTMAN_VERSION: 36ca1bdb1e011be3a314b716a59444bf51875f1f

steps:
  - label: ':docker: Build'
    command: docker-compose build app

  - wait

  - label: ':docker: Push'
    command: docker-compose push app

  - wait

  - label: ':s3: Upload'
    command:
      - '/buildkite/scripts/upload-s3.sh chronojob.yaml'
    agents:
      queue: 'eks2'

  - wait

  - label: ':kubernetes: Deploy'
    branches: 'master'
    command:
      - '/buildkite/scripts/spinnaker.sh chronojob'
    agents:
      queue: 'eks2'
